<p>Les champs marqués d'une astérisque (*) sont obligatoires.</p>
<%= form_for(@convocation) do |f| %>
  <p>
    <%= f.label(:title, "Titre (*)", :class => "span-1 first") %>
    <span class="span-3">
      <%= f.text_field(:title, :class => "span-2 first") %>
      <%= error_message_on(:convocation, :title, :css_class => "span-2 first") %>
    </span>
  </p>
  <p>
    <%= f.label(:date, "Date (*)", :class => "span-1 first") %>
    <span class="span-3">
      <%= f.text_field(:date, :value => l!(f.object.date), :class => "span-2 first date") %>
      <%= error_message_on(:convocation, :date, :css_class => "span-2 first") %>
    </span>
  </p>
  <p>
    <%= f.label(:place, "Lieu (*)", :class => "span-1 first") %>
    <span class="span-3">
      <%= f.text_field(:place, :class => "span-2 first") %>
      <%= error_message_on(:convocation, :place, :css_class => "span-2 first") %>
    </span>
  </p>
  <p>
    <%= f.label(:uniform, "Tenue (*)", :class => "span-1 first") %>
    <span class="span-3">
      <%= collection_select(:convocation, :uniform_id, @station.uniforms.all, :id, :title) %>
      <%= error_message_on(:convocation, :uniform, :css_class => "span-2 first") %>
    </span>
  </p>
  <p>
    <%= f.label(:hide_grade, "Masquer les grades à l'impression", :class => "span-1 first") %>
    <span class="span-3">
      <%= f.check_box(:hide_grade, :class => "span-2 first") %>
    </span>
  </p>
  <p>
    <%= f.label(:rem, "Remarque", :class => "span-1 first") %>
    <span class="span-3">
      <%= f.text_area(:rem, :class => "span-2 first", :rows => 5) %>
    </span>
  </p>
  <div>
    <%= f.label(:firemen, "Personnel (*)", :class => "span-1 first") %>
    <span class="span-3">
      <table>
        <%- @firemen.group_by(&:status).sort.reverse.each do |status, firemen| -%>
          <tr>
            <td><%= Fireman::STATUS_PLURAL.key(status) %></td>
            <td><%= link_to("Cocher/décocher", "#", :id => "change_status_#{status}", :class => "change_status")%></td>
            <td>
              <ul>
                <%= render :partial => "fireman", :collection => firemen, :locals => {:status => status} %>
              </ul>
            </td>
          </tr>
        <%- end -%>
      </table>
      <%- content_for(:javascript) do -%>
        $('.click_prev_checkbox').click(function(){
          var checkbox = $(this).prev(':checkbox');
          checkbox.attr('checked', !checkbox.attr('checked'));
        });
        $('.change_status').click(function() {
          parts = $(this).attr('id').split('_');
          $('.status_'+parts[2]).attr('checked',!$('.status_'+parts[2]).attr('checked'));
          return false;
        });
      <%- end -%>
      <%= error_message_on(:convocation, :firemen) %>
    </span>
  </div>
  <div class="span-3 first prefix-1">
    <%= submit_tag("Enregistrer") %> ou <%= link_to("Annuler", convocations_path) %>
  </div>
<%- end -%>
<%- content_for(:header) do -%>
  <%= stylesheet_link_tag("back/master.css", "back/jquery-ui-#{SpGestion::JQUERY_UI_VERSION}.blitzer.css")%>
  <%= javascript_include_tag("jquery-ui-#{SpGestion::JQUERY_UI_VERSION}.min.js", "jquery-ui-i18n-#{SpGestion::JQUERY_UI_VERSION}.min.js", "jquery-ui-timepicker-addon.js") %>
<%- end -%>
<%- content_for(:javascript) do -%>
  $.datepicker.setDefaults($.datepicker.regional['fr']);
  $.timepicker.setDefaults($.timepicker.regional['fr']);
  $('.date').datetimepicker({ showMonthAfterYear: false,
                              changeYear: true,
                              changeMonth: true,
                              dateFormat: 'dd/mm/yy',
                              constrainInput: true,
                              minDate: '+0',
                              maxDate: '+1y',
                              duration: '',
                              showTime: true,
                              stepMinute: 5});
<%- end -%>